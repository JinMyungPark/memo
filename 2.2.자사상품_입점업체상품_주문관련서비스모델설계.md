A 고객사의 비즈니스 유연성과 성능을 고려하여 자사 직접 판매 상품뿐만 아니라 입점 업체에 대한 상품 주문 관련 서비스 모델을 설계하려면, 데이터 모델을 효과적으로 구성하는 것이 핵심입니다. 이 모델은 확장성, 성능, 그리고 유연성을 보장해야 하며, 다양한 상품 유형과 주문 처리 흐름을 효율적으로 관리할 수 있어야 합니다.

### 1. 데이터 모델 설계

#### **1.1 주요 엔터티**

1. **Product (상품)**
   - **ProductID (PK)**: 상품 고유 식별자
   - **ProductName**: 상품명
   - **Description**: 상품 설명
   - **Price**: 상품 가격
   - **StockQuantity**: 재고 수량
   - **CategoryID (FK)**: 상품이 속한 카테고리
   - **SupplierID (FK)**: 공급업체 (자사 또는 입점 업체)
   - **IsDirectSale**: 자사 직접 판매 여부 (True/False)
   - **CreatedDate**: 상품 등록일
   - **ModifiedDate**: 상품 수정일

2. **Category (카테고리)**
   - **CategoryID (PK)**: 카테고리 고유 식별자
   - **CategoryName**: 카테고리명
   - **ParentCategoryID (FK)**: 상위 카테고리 (없을 경우 NULL)
   
3. **Supplier (공급업체)**
   - **SupplierID (PK)**: 공급업체 고유 식별자
   - **SupplierName**: 공급업체명
   - **ContactInfo**: 공급업체 연락처 정보
   - **IsPartner**: 입점업체 여부 (True/False)
   - **CommissionRate**: 입점업체의 경우, 수수료율

4. **Order (주문)**
   - **OrderID (PK)**: 주문 고유 식별자
   - **CustomerID (FK)**: 주문한 고객 식별자
   - **OrderDate**: 주문일
   - **TotalAmount**: 주문 총액
   - **OrderStatus**: 주문 상태 (예: Pending, Shipped, Delivered, Cancelled)
   - **ShippingAddress**: 배송지 정보
   - **PaymentMethod**: 결제 방식 (예: 신용카드, 페이팔 등)

5. **OrderItem (주문 항목)**
   - **OrderItemID (PK)**: 주문 항목 고유 식별자
   - **OrderID (FK)**: 주문 식별자
   - **ProductID (FK)**: 주문한 상품 식별자
   - **Quantity**: 주문 수량
   - **UnitPrice**: 주문 당시의 상품 가격
   - **TotalPrice**: 주문 항목의 총액 (Quantity * UnitPrice)
   - **SupplierID (FK)**: 공급업체 식별자 (자사 또는 입점 업체)

6. **Customer (고객)**
   - **CustomerID (PK)**: 고객 고유 식별자
   - **CustomerName**: 고객명
   - **Email**: 고객 이메일
   - **Phone**: 고객 전화번호
   - **ShippingAddress**: 기본 배송지 정보
   - **BillingAddress**: 기본 결제 주소

#### **1.2 관계 정의**

- **Product**는 **Category**와 다대일(N:1) 관계: 하나의 상품은 하나의 카테고리에 속할 수 있으며, 하나의 카테고리는 여러 상품을 가질 수 있습니다.
- **Product**는 **Supplier**와 다대일(N:1) 관계: 하나의 상품은 하나의 공급업체(자사 또는 입점 업체)에 의해 제공됩니다.
- **Order**는 **Customer**와 다대일(N:1) 관계: 하나의 주문은 하나의 고객에 의해 생성됩니다.
- **Order**는 **OrderItem**과 일대다(1:N) 관계: 하나의 주문에는 여러 개의 주문 항목이 포함될 수 있습니다.
- **OrderItem**은 **Product**와 다대일(N:1) 관계: 하나의 주문 항목은 하나의 상품에 대응됩니다.
- **OrderItem**은 **Supplier**와 다대일(N:1) 관계: 각 주문 항목은 그 상품을 제공하는 공급업체를 참조합니다.

### 2. 설계 사유

1. **유연성**:
   - **Supplier 엔터티**를 통해 자사와 입점 업체를 구분하면서도 동일한 구조로 관리할 수 있도록 하였습니다. 이는 새로운 입점 업체가 추가되더라도 데이터 모델을 변경하지 않고 쉽게 확장할 수 있게 해줍니다.
   - **IsDirectSale** 및 **IsPartner** 필드를 통해 자사 판매 상품과 입점 업체 상품을 구분하며, 조건에 따라 다양한 비즈니스 로직을 유연하게 적용할 수 있습니다.

2. **성능 최적화**:
   - **OrderItem** 테이블에 **ProductID**와 **SupplierID**를 명시적으로 포함시켜, 주문 데이터를 조회할 때 상품과 공급업체 정보를 효율적으로 가져올 수 있도록 설계하였습니다.
   - **StockQuantity**와 같은 필드를 **Product** 테이블에 포함하여, 재고 관리와 관련된 성능 문제를 최소화하였습니다.

3. **확장성**:
   - **Category** 엔터티는 계층 구조를 지원하도록 설계하여, 향후 다양한 카테고리 레벨을 추가할 수 있도록 하였습니다. 또한, **ParentCategoryID** 필드를 통해 카테고리 트리를 구성할 수 있습니다.
   - **Supplier** 테이블의 **CommissionRate** 필드를 통해 입점 업체별 수수료 구조를 유연하게 설정할 수 있습니다.

4. **데이터 일관성**:
   - 주문 항목에 **UnitPrice**를 포함하여, 주문 당시의 가격이 변경되더라도 과거 주문 내역의 데이터 일관성을 유지하도록 하였습니다.
   - **OrderStatus** 필드를 통해 주문 상태를 명확하게 관리하고, 비즈니스 로직에서 상태에 따라 다른 처리를 적용할 수 있도록 하였습니다.

### 3. 비즈니스 로직 및 흐름

1. **상품 등록 및 관리**:
   - 자사와 입점 업체는 각각 상품을 등록하고 관리할 수 있으며, **Product** 테이블의 **SupplierID**를 통해 자사와 입점 업체 상품을 구분합니다.
   - 입점 업체는 자신의 상품만 조회 및 수정할 수 있습니다.

2. **주문 처리**:
   - 고객이 주문을 생성하면, **Order** 및 **OrderItem** 테이블에 기록됩니다.
   - 각 주문 항목은 해당 상품의 공급업체(SupplierID)를 참조하여, 자사 또는 입점 업체로 주문을 전달합니다.

3. **결제 및 수수료 관리**:
   - 결제가 완료되면 **Order** 테이블의 **OrderStatus**를 'Paid'로 변경하고, 입점 업체의 경우 **CommissionRate**를 적용하여 수수료를 계산합니다.

4. **재고 관리**:
   - **Product** 테이블의 **StockQuantity**를 통해 재고를 관리하며, 주문이 들어올 때마다 해당 상품의 재고 수량이 감소합니다. 재고가 부족할 경우 주문을 거부하거나, 입점 업체의 경우 자동 발주를 제안할 수 있습니다.

### 4. 결론

이 데이터 모델은 A 고객사가 자사 상품과 입점 업체의 상품을 모두 유연하고 효율적으로 관리할 수 있도록 설계되었습니다. 유연성과 확장성, 성능을 모두 고려한 이 모델은 비즈니스 요구 사항의 변화에도 쉽게 적응할 수 있으며, 고성능의 주문 처리와 재고 관리를 지원합니다.
